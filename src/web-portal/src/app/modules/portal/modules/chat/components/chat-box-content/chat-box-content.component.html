<div class="close-icon" (click)="onClosed()">
    <mat-icon [inline]="true">cancel</mat-icon>
</div>
<div class="row">
    <div class="col-lg-12 d-flex align-items-end online-user">
        <div class="w-25" *ngIf="!hasAvatar">
            <div class="rounded-circle tile-icon-revert d-flex align-items-center justify-content-center">
                {{roomShortName}}
            </div>
        </div>
        <div class="w-75 text-left">
            <h6>{{roomName}}</h6>
        </div>
    </div>
</div>
<div class="row pt-2">
    <div [ngStyle]="{'height': (heightChatContent + 'px')}" class="col-lg-12 scrollable chat-box-content-area"
        #messageContainer (scroll)="scrollChat($event)">
        <div class="w-100" *ngIf="displayShowMore">
            <div class="d-flex justify-content-center">
                <mat-spinner [diameter]="20" mode="indeterminate"></mat-spinner>
            </div>
        </div>
        <ng-container *ngFor="let message of messages$ | async">
            <div class="w-75 pt-2 d-flex flex-column "
                [ngClass]="{'received_mess align-items-start': message.isReceived, 'sent_mess align-items-end': !message.isReceived}">
                <p class="mb-1">
                    {{message.message}}</p>
                <div class="time-text">
                    {{translateTimeText(message)}}
                </div>
            </div>
        </ng-container>
    </div>
</div>
<div *ngIf="connectionState else reconnecting"></div>
<form [formGroup]="formGroup" #form="ngForm" [hidden]="!connectionState">
    <div class="row">
        <div class="col-lg-12 pl-3 pr-3" #formFieldWarpper>
            <mat-form-field class="field-full-width chat-text">
                <textarea matInput #textInput placeholder="Aa" maxlength="1000" formControlName="text"
                    [errorStateMatcher]="errorMatcher" autocomplete="off" cdkTextareaAutosize
                    #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5" (keydown.enter)="onKeydown($event)">
                </textarea>
                <!-- <input matInput placeholder="Aa" #textInput formControlName="text" maxlength="250"
                    [errorStateMatcher]="errorMatcher" autocomplete="off" /> -->
                <mat-icon matSuffix style="cursor: pointer;">
                    mood</mat-icon>
            </mat-form-field>
            <div (click)="toggled = !toggled" [(emojiPickerIf)]="toggled" [emojiPickerDirection]="'top'"
                (emojiPickerSelect)="emotionPicked($event)" class="field-full-width overlay-emotion">
            </div>
        </div>
        <div class="col-lg-12">
            <div class="float-left">
                <button mat-icon-button color="primary" matTooltip="Attachment" [matTooltipPosition]="'above'">
                    <mat-icon>attach_file</mat-icon>
                </button>
            </div>
            <div class="float-right pt-1">
                <button mat-button color="primary" (click)="send()">Send</button>
            </div>
        </div>
    </div>
</form>
<ng-template #reconnecting>
    <div class="row d-flex justify-content-center">
        <p>Chat isn't available, reconnecting...</p>
    </div>
</ng-template>
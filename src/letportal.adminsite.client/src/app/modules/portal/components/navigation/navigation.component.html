<div class="portal-container">
  <mat-toolbar color="primary">
    <mat-toolbar-row>
      <!-- Left top bar -->
      <button type="button" aria-label="Toggle sidenav" mat-icon-button (click)="drawer.toggle()"
        *ngIf="hasSelectedApp">
        <mat-icon aria-label="Side nav toggle icon">menu</mat-icon>
      </button>
      <!-- Logo here-->
      <img class="logo-small" src="logo.ico" />
      <!-- End logo-->
      <!-- Right top bar-->
      <span class="divider-left-right-bar"></span>
      <notification-box></notification-box>
      <ng-container *ngIf="!hasAvatar">
        <div class="rounded-circle tile-icon d-flex align-items-center justify-content-center"
          [matMenuTriggerFor]="menu" aria-label="More">
          {{userShortName}}
        </div>
      </ng-container>
      <ng-container *ngIf="hasAvatar">
        <div class="rounded-circle tile-icon d-flex align-items-center justify-content-center"
          [matMenuTriggerFor]="menu" aria-label="More">
          <img [src]="authUser.avatar | secureFile | async" class="rounded-circle user-avatar"/>
        </div>
      </ng-container>
      <mat-menu #menu="matMenu" xPosition="before">
        <p mat-menu-item disabled>
          {{ 'navigation.hiText' | translate }}, {{authUser.fullName}}
        </p>
        <mat-divider></mat-divider>
        <button mat-menu-item [matMenuTriggerFor]="themeMenu">
          <mat-icon>palette</mat-icon>
          {{ 'pages.login.theme.label' | translate }}
        </button>
        <button mat-menu-item [matMenuTriggerFor]="modeMenu">
          <mat-icon>dark_mode</mat-icon>
          {{ 'pages.login.themeMode.label' | translate }}
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="profile()">
          <mat-icon>account_box</mat-icon>
          {{ 'navigation.profileText' | translate }}
        </button>
        <button mat-menu-item (click)="appDashboard()">
          <mat-icon>dashboard</mat-icon>
          {{ 'navigation.appsText' | translate }}
        </button>
        <button mat-menu-item (click)="logout()">
          <mat-icon>power_settings_new</mat-icon>
          {{ 'navigation.logoutText' | translate }}
        </button>
      </mat-menu>

      <mat-menu #themeMenu="matMenu">
        <button mat-menu-item *ngFor="let theme of themeOptions" (click)="changeTheme(theme.key)">
          <mat-icon>{{ selectedTheme === theme.key ? 'radio_button_checked' : 'radio_button_unchecked' }}</mat-icon>
          <span>{{ theme.labelKey | translate }}</span>
          <span class="theme-swatch" [attr.data-theme]="theme.key" [class.selected]="selectedTheme === theme.key"></span>
        </button>
      </mat-menu>

      <mat-menu #modeMenu="matMenu">
        <button mat-menu-item *ngFor="let mode of themeModeOptions" (click)="changeMode(mode.key)">
          <mat-icon>{{ mode.icon }}</mat-icon>
          <span>{{ mode.labelKey | translate }}</span>
          <mat-icon class="mode-check" *ngIf="selectedMode === mode.key">check</mat-icon>
        </button>
      </mat-menu>
    </mat-toolbar-row>
  </mat-toolbar>
  <mat-sidenav-container class="sidenav-container" [hasBackdrop]="true">
    <mat-sidenav #drawer class="sidenav" fixedInViewport="false"
      [attr.role]="(isHandset$ | async) ? 'dialog' : 'navigation'" [mode]="'over'" [opened]="hasMenu" fixedTopGap="56">
      <mat-expansion-panel class="no-border-box" *ngFor="let menu of menus">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <b class="parent-menu">{{menu.displayName}}</b>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-nav-list>
          <ng-container *ngFor="let child of menu.subMenus">
            <a *ngIf="!child.hide" mat-list-item
              [routerLink]="child.url.startsWith('/') ? child.url : ('/' + child.url)" routerLinkActive="true"
              class="sub-menu">
                {{child.displayName}}
            </a>
          </ng-container>
        </mat-nav-list>
      </mat-expansion-panel>
    </mat-sidenav>
    <mat-sidenav-content>
      <mat-progress-bar *ngIf="loading" color="accent" mode="indeterminate">
      </mat-progress-bar>
      <ng-content select="[mainContent]"></ng-content>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
